<h1>Integration Test for maven-ooo-plugin</h1>
<p>This is the integration test project for the maven-ooo-plugin. The use of this plugin is described on the OpenOffice.org wiki article <a href="http://wiki.services.openoffice.org/wiki/OpenOffice_Maven2_Integration">OpenOffice Maven2 Integration</a>.</p>
<p>This README file is used as input file for <a href="http://fit.c2.com">FIT</a> which understands only HTML. So don't wonder about the .textile suffix of this README. It is used because <a href="http://github.com">github</a> supports this kind of README but you will find no <a href="http://www.textism.com/tools/textile">textile syntax</a> inside, only HTML.</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.FileFixture</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>deleteDir</td>
      <td>ooo-ext-test</td>
    </tr>
  </tbody>
</table>
<p>To begin with the example we must first delete the created artifact directory from the last try.</p>

<h2>Features</h2>
<p>The structure of this README follows the structure of <a href="http://wiki.services.openoffice.org/wiki/OpenOffice_Maven2_Integration">OpenOffice Maven2 Integration</a> and adds the table neeed for the integration tests of the maven-ooo-plugin.</p>

<h3>Generating an Extension project</h3>
<p>This will be done, by using a maven archetype for Uno projects.</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.MvnShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>archetype:generate</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-DnewGroupId=org.openoffice.dev.tests</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-DnewArtifactId=ooo-ext-test</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-DnewVersion=0.1-SNAPSHOT</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-Dpackage=org.openoffice.dev</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-DarchetypeGroupId=org.openoffice.dev</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-DarchetypeArtifactId=maven-ooo-plugin</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-DarchetypeVersion=1.1-RC1</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>As a result you'll get a Maven project which can be validated using 'mvn validate':</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.MvnShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>changeWorkingDir</td>
      <td>ooo-ext-test</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>validate</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>The following files will be generated by 'mvn archetype:generate -DartifactId=ooo-ext-test...':</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">org.openoffice.maven.it.fixture.FileFixture</td>
    </tr>
    <tr>
      <td><b>file</b></td>
      <td><b>type()</b></td>
      <td><b>comment</b></td>
    </tr>
    <tr>
      <td>ooo-ext-test/pom.xml</td>
      <td>file</td>
      <td>example POM</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/idl</td>
      <td>dir</td>
      <td>directory for IDL sources</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/idl/hello/WorldInterface.idl</td>
      <td>file</td>
      <td>sample IDL</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/java</td>
      <td>dir</td>
      <td>directory for Java sources</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/java/org/openoffice/dev/RegistrationHandler.java</td>
      <td>file</td>
      <td>registration handler</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/java/org/openoffice/dev/DemoAddOn.java</td>
      <td>file</td>
      <td>a little demo addon</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/resources</td>
      <td>dir</td>
      <td>directory for resources</td>
    </tr>
    <tr>
      <td>ooo-ext-test/src/main/resources/org/openoffice/dev/RegistrationHandler.classes</td>
      <td>file</td>
      <td>input resource for RegistrationHandler</td>
    </tr>
  </tbody>
</table>

<h3>Creating a new UNO type implementation</h3>
<p>This feature is not yet developed.</p>

<h3>Building the IDL files</h3>
<p>The Java classes corresponding to the UNO types defined in the IDL files are generated before the Java compilation phase.</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.MvnShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>changeWorkingDir</td>
      <td>ooo-ext-test</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>generate-sources</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>The following files will be generated by 'mvn generate-sources' (see <a href="http://wiki.services.openoffice.org/wiki/JavaEclipseTuto#Components_creation_process">Components creation process</a> for an overview about the UNO commands):</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">org.openoffice.maven.it.fixture.FileFixture</td>
    </tr>
    <tr>
      <td><b>file</b></td>
      <td><b>type()</b></td>
      <td><b>comment</b></td>
    </tr>
    <tr>
      <td>ooo-ext-test/target/urd</td>
      <td>dir</td>
      <td>output for the idlc command</td>
    </tr>
    <tr>
      <td>ooo-ext-test/target/urd/hello/WorldInterface.urd</td>
      <td>file</td>
      <td>the compiled WorldInterface.idl</td>
    </tr>
    <tr>
      <td>ooo-ext-test/target/types.rdb</td>
      <td>file</td>
      <td>result of the regmerge command</td>
    </tr>
  </tbody>
</table>

<h3>Generating the OOo-Plugin</h3>
<p>With 'mvn package' the OpenOffice extension will be generated:</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.MvnShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>changeWorkingDir</td>
      <td>ooo-ext-test</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>package</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>You'll find the generated plugin in the target directory:</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">org.openoffice.maven.it.fixture.FileFixture</td>
    </tr>
    <tr>
      <td><b>file</b></td>
      <td><b>type()</b></td>
      <td><b>comment</b></td>
    </tr>
    <tr>
      <td>ooo-ext-test/target/ooo-ext-test-0.1-SNAPSHOT.oxt</td>
      <td>file</td>
      <td>the generated OOo extension</td>
    </tr>
  </tbody>
</table>

<h3>Installation...</h3>
Before we test the installation to the local Maven repository we delete first
the directory with the installed artifact:
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.FileFixture</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>deleteDir</td>
      <td>${user.home}/.m2/repository/org/openoffice/dev/tests/ooo-ext-test</td>
    </tr>
  </tbody>
</table>

<h4>...as Maven Artifact</h4>
<p>Normally the generated OOo plugin is installed direct as OOo plugin. If you don't want this and want to install the OOo plugin as artifact into your local Maven repository you can use the system property "org.openoffice.maven.install=repository":</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.MvnShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>changeWorkingDir</td>
      <td>ooo-ext-test</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>install</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>-Dorg.openoffice.maven.install=repository</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>In this case the generated OOo plugin is not install into OpenOffice but you find it in your local Maven repository which is normally located into your home directory under ".m2/repository":</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">org.openoffice.maven.it.fixture.FileFixture</td>
    </tr>
    <tr>
      <td><b>file</b></td>
      <td><b>type()</b></td>
      <td><b>comment</b></td>
    </tr>
    <tr>
      <td>${user.home}/.m2/repository/org/openoffice/dev/tests/ooo-ext-test/0.1-SNAPSHOT</td>
      <td>dir</td>
      <td>directory with artifact of version 0.1-SNAPSHOT</td>
    </tr>
    <tr>
      <td>${user.home}/.m2/repository/org/openoffice/dev/tests/ooo-ext-test/0.1-SNAPSHOT/ooo-ext-test-0.1-SNAPSHOT.oxt</td>
      <td>file</td>
      <td>installed artifact</td>
    </tr>
    <tr>
      <td>${user.home}/.m2/repository/org/openoffice/dev/tests/ooo-ext-test/0.1-SNAPSHOT/ooo-ext-test-0.1-SNAPSHOT.pom</td>
      <td>file</td>
      <td>POM file</td>
    </tr>
  </tbody>
</table>

<h4>...as OOo-Plugin</h4>
<p>Be sure thet the plugin isn't installed already. If yes call 'unopkg remove ooo-ext-test-0.1-SNAPSHOT.oxt'. Then you can install the generated OOo plugin of the previous step with the 'unopkg' command ('unopkg add -v ooo-ext-test-0.1-SNAPSHOT.oxt'). Or you can use the install phase of Maven and call 'mvn install':</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.CmdShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>setCommand</td>
      <td>unopkg</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>remove</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>ooo-ext-test-0.1-SNAPSHOT.oxt</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.MvnShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>changeWorkingDir</td>
      <td>ooo-ext-test</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>install</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>To verify if the OOo plugin is really installed you can start OpenOffice and select the extension manager of you can use 'unopkg list' from the commandline. <b>If you start 'unopkg' be sure OpenOpffice is not running!</b></p>

<h3>Uninstalling the OOo-Plugin</h3>
<p>You can use OpenOffice's extension manager or 'unopkg remove ooo-ext-test-0.1-SNAPSHOT.oxt' to deinstall the OOo plugin:</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="3">fit.ActionFixture</td>
    </tr>
    <tr>
      <td>start</td>
      <td colspan="2">org.openoffice.maven.it.fixture.CmdShell</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>setCommand</td>
      <td>unopkg</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>remove</td>
    </tr>
    <tr>
      <td>enter</td>
      <td>addArgument</td>
      <td>ooo-ext-test-0.1-SNAPSHOT.oxt</td>
    </tr>
    <tr>
      <td>press</td>
      <td colspan="2">run</td>
    </tr>
    <tr>
      <td>check</td>
      <td>getExitCode</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>To verify if the OOo plugin is really deinstalled you can start 'unopkg list' from the commandline and see if plugin is absent.</p>

<h2>Appendix</h2>
<h3>History</h3>
<table cellspacing="0" cellpadding="3" border="1">
  <tbody>
    <tr>
      <td colspan="2">org.openoffice.maven.it.fixture.IgnoreFixture</td>
    </tr>
    <tr>
  	  <td><b>Date</b></td>
  	  <td><b>Remarks</b></td>
    </tr>
    <tr>
  	  <td>02-Nov-2010</td>
  	  <td>created</td>
    </tr>
  </tbody>
</table>

<h3>Summary</h3>
<p>
  The following table will be filled by FIT if you use this document as
  input file.
</p>
<table cellspacing="0" cellpadding="3" border="1">
  <tr>
  	<td colspan="2">fit.Summary</td>
  </tr>
</table>
